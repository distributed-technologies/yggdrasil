# https://github.com/cortexproject/cortex-helm-chart/blob/ad2f5cf3ce961af813fc73b9530be75a585322ac/templates/distributor/distributor-dep.yaml#L93
bucketClaim:
  # Enableing the bucket claim
  enabled: true
  # The name of the bucket claim
  name: tempo-bucket-claim
  # Annotations for the bucket claim
  annotations:
    # This annotations makes it so ArgoCD will not complain if the CRD's are missing
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
  # Name of the bucket in which to make the claim
  bucketName: tempo-bucket
  # Name of the storageClass that contains the bucket provider
  storageClassName: ceph-bucket

tempo-distributed:
  ingester:
    # `config.expand-env: "true"` Allows the use of env vars in the config
    extraArgs:
      - -config.expand-env=true

    # -- Environment variables to add to the ingester pods
    extraEnv:
      {{- include "bucket-claim.env-var" "tempo-bucket-claim" | indent 6 }}

  distributor:
    # `config.expand-env: "true"` Allows the use of env vars in the config
    extraArgs:
      - -config.expand-env=true

    # -- Environment variables to add to the distributor pods
    extraEnv:
      {{- include "bucket-claim.env-var" "tempo-bucket-claim" | indent 6 }}

  compactor:
    # `config.expand-env: "true"` Allows the use of env vars in the config
    extraArgs:
      - -config.expand-env=true

    # -- Environment variables to add to the compactor pods
    extraEnv:
      {{- include "bucket-claim.env-var" "tempo-bucket-claim" | indent 6 }}

  querier:
    # `config.expand-env: "true"` Allows the use of env vars in the config
    extraArgs:
      - -config.expand-env=true

    # -- Environment variables to add to the querier pods
    extraEnv:
      {{- include "bucket-claim.env-var" "tempo-bucket-claim" | indent 6 }}

  queryFrontend:
    # `config.expand-env: "true"` Allows the use of env vars in the config
    extraArgs:
      - -config.expand-env=true

    # -- Environment variables to add to the query-frontend pods
    extraEnv:
      {{- include "bucket-claim.env-var" "tempo-bucket-claim" | indent 6 }}

  # -- the supported storage backends are gcs, s3 and azure
  # -- as specified in https://grafana.com/docs/tempo/latest/configuration/#storage
  storage:
    trace:
      backend: s3
      s3:
        # Bucket name in s3
        # Tempo requires a dedicated bucket since it maintains a top-level object structure and does not support
        # a custom prefix to nest within a shared bucket.
        bucket: ${BUCKET_NAME}

        # api endpoint to connect to. use AWS S3 or any S3 compatible object storage endpoint.
        # Example: "endpoint: s3.dualstack.us-east-2.amazonaws.com"
        endpoint: ${BUCKET_HOST}

        # optional.
        # By default the region is inferred from the endpoint,
        # but is required for some S3-compatible storage engines.
        # Example: "region: us-east-2"
        region: ${BUCKET_REGION}

        # optional.
        # access key when using static credentials.
        access_key: ${AWS_ACCESS_KEY_ID}

        # optional.
        # secret key when using static credentials.
        secret_key: ${AWS_SECRET_ACCESS_KEY}

        # optional.
        # enable if endpoint is http
        insecure: true

  # This setting allows the use of the traces search function in grafana (This is currently a beta part and also has to be added in grafana.)
  search:
    enabled: true

  # I have left this in for clarity, since i'm uncertain which type of trace interface we need
  traces:
    jaeger:
      # -- Enable Tempo to ingest Jaeger GRPC traces
      grpc: true
      # -- Enable Tempo to ingest Jaeger Thrift Binary traces
      thriftBinary: true
      # -- Enable Tempo to ingest Jaeger Thrift Compact traces
      thriftCompact: true
      # -- Enable Tempo to ingest Jaeger Thrift HTTP traces
      thriftHttp: true
    # -- Enable Tempo to ingest Zipkin traces
    zipkin: false
    otlp:
      # -- Enable Tempo to ingest Open Telemetry HTTP traces
      http: false
      # -- Enable Tempo to ingest Open Telemetry GRPC traces
      grpc: false
    # -- Enable Tempo to ingest Open Census traces
    opencensus: false
    # -- Enable Tempo to ingest traces from Kafka. Reference: https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/kafkareceiver
    kafka: {}

  # ServiceMonitor configuration
  serviceMonitor:
    # -- If enabled, ServiceMonitor resources for Prometheus Operator are created
    enabled: true
    labels:
      instance: primary
